{"ast":null,"code":"import React,{useState,useEffect}from'react';import axios from'axios';import{useNavigate}from'react-router-dom';import{isTokenValid}from'./Auth';/**\n * UserReviews Component\n * \n * This component fetches and displays the current user's profile and their reviews.\n * It also allows the user to edit or delete their reviews and update their profile.\n */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const UserReviews=()=>{const[user,setUser]=useState({});const[reviews,setReviews]=useState([]);const[error,setError]=useState('');const navigate=useNavigate();const token=localStorage.getItem('token');// If token is invalid, redirect to the login page\nuseEffect(()=>{if(!isTokenValid()){navigate('/api/login/');return;}// Fetch user profile data\naxios.get('/api/user/profile/',{headers:{Authorization:`Bearer ${token}`}}).then(response=>{setUser(response.data);}).catch(error=>{console.error('Error fetching user data:',error);});// Fetch the user's reviews\nconst fetchUserReviews=async()=>{try{const response=await axios.get('/reviews/user/',{headers:{Authorization:`Bearer ${token}`}});const sortedReviews=response.data.sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));setReviews(sortedReviews);}catch(error){setError('An error occurred while fetching the reviews.');console.error(error);}};fetchUserReviews();},[token,navigate]);// Navigates to the profile editing page\nconst handleEditProfile=()=>{navigate('/edit_profile/');};// Deletes a review by ID and updates the review list in the UI\nconst deleteReview=async reviewId=>{const confirmDelete=window.confirm(\"Are you sure you want to delete this review?\");if(!confirmDelete)return;try{await axios.delete(`/reviews/${reviewId}/delete/`,{headers:{Authorization:`Bearer ${token}`}});setReviews(reviews.filter(review=>review.id!==reviewId));}catch(error){setError('An error occurred while deleting the review.');console.error(error);}};// Navigates to the review editing page with the selected review ID\nconst handleEdit=reviewId=>{navigate(`/reviews/edit/${reviewId}`);};return/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex flex-column align-items-center my-5\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"d-flex align-items-center mb-4 mt-5\",children:[user.profile_image&&/*#__PURE__*/_jsx(\"img\",{src:user.profile_image// Displays the user's profile image if available\n,alt:\"User Profile\",className:\"rounded-circle\",style:{width:'100px',height:'100px',objectFit:'cover',marginRight:'15px'}}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-primary\",onClick:handleEditProfile// Button to edit user profile\n,children:\"Edit Profile\"})]}),/*#__PURE__*/_jsx(\"div\",{children:user.is_superuser&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-primary mt-3\",onClick:()=>window.open('http://localhost:8000/admin/','_blank')// Redirect to Django admin\n,children:\"Admin Panel\"})}),/*#__PURE__*/_jsxs(\"h1\",{children:[\"Hello \",user.username,\", Welcome to your reviews!\"]}),error&&/*#__PURE__*/_jsx(\"p\",{className:\"text-danger\",children:error}),\" \",/*#__PURE__*/_jsx(\"ul\",{className:\"list-unstyled\",children:reviews.length>0?reviews.map(review=>/*#__PURE__*/_jsxs(\"li\",{className:\"mb-4 mt-5\",children:[review.img&&/*#__PURE__*/_jsx(\"div\",{className:\"d-flex justify-content-center mb-2 mt-5\",children:/*#__PURE__*/_jsx(\"img\",{src:review.img,alt:review.title,className:\"img-fluid\",style:{maxWidth:'200px',height:'auto'}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h4\",{children:review.title}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Author/Director:\"}),\" \",review.author_director]}),/*#__PURE__*/_jsx(\"p\",{children:review.content}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Genre:\"}),\" \",review.genre_name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Rating:\"}),\" \",review.rating,\"/5\"]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary me-2\",onClick:()=>handleEdit(review.id),children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-danger\",onClick:()=>deleteReview(review.id),children:\"Delete\"})]})]},review.id)):/*#__PURE__*/_jsx(\"p\",{children:\"No reviews found.\"})})]});};export default UserReviews;","map":{"version":3,"names":["React","useState","useEffect","axios","useNavigate","isTokenValid","jsx","_jsx","jsxs","_jsxs","UserReviews","user","setUser","reviews","setReviews","error","setError","navigate","token","localStorage","getItem","get","headers","Authorization","then","response","data","catch","console","fetchUserReviews","sortedReviews","sort","a","b","Date","created_at","handleEditProfile","deleteReview","reviewId","confirmDelete","window","confirm","delete","filter","review","id","handleEdit","className","children","profile_image","src","alt","style","width","height","objectFit","marginRight","onClick","is_superuser","open","username","length","map","img","title","maxWidth","author_director","content","genre_name","rating"],"sources":["/Users/marcelotavares/Desktop/newBooks/newBooksFrontend/review-platform-frontend/src/components/Profile.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { useNavigate } from 'react-router-dom';\nimport { isTokenValid } from './Auth';\n\n/**\n * UserReviews Component\n * \n * This component fetches and displays the current user's profile and their reviews.\n * It also allows the user to edit or delete their reviews and update their profile.\n */\nconst UserReviews = () => {\n    const [user, setUser] = useState({});\n    const [reviews, setReviews] = useState([]);\n    const [error, setError] = useState('');\n    const navigate = useNavigate();\n    const token = localStorage.getItem('token');\n\n    // If token is invalid, redirect to the login page\n    useEffect(() => {\n        if (!isTokenValid()) {\n            navigate('/api/login/');\n            return;\n        }\n\n        // Fetch user profile data\n        axios.get('/api/user/profile/', {\n            headers: { Authorization: `Bearer ${token}` },\n        })\n            .then(response => {\n                setUser(response.data);\n            })\n            .catch(error => {\n                console.error('Error fetching user data:', error);\n            });\n\n        // Fetch the user's reviews\n        const fetchUserReviews = async () => {\n\n            try {\n                const response = await axios.get('/reviews/user/', {\n                    headers: {\n                        Authorization: `Bearer ${token}`,\n                    },\n\n                });\n\n                const sortedReviews = response.data.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));\n\n                setReviews(sortedReviews);\n            } catch (error) {\n                setError('An error occurred while fetching the reviews.');\n                console.error(error);\n            }\n        };\n\n        fetchUserReviews();\n    }, [token, navigate]);\n\n    // Navigates to the profile editing page\n    const handleEditProfile = () => {\n        navigate('/edit_profile/');\n    };\n\n    // Deletes a review by ID and updates the review list in the UI\n    const deleteReview = async (reviewId) => {\n        const confirmDelete = window.confirm(\"Are you sure you want to delete this review?\");\n        if (!confirmDelete) return;\n\n        try {\n            await axios.delete(`/reviews/${reviewId}/delete/`, {\n                headers: {\n                    Authorization: `Bearer ${token}`,\n                },\n            });\n            setReviews(reviews.filter(review => review.id !== reviewId));\n        } catch (error) {\n            setError('An error occurred while deleting the review.');\n            console.error(error);\n        }\n    };\n\n    // Navigates to the review editing page with the selected review ID\n    const handleEdit = (reviewId) => {\n        navigate(`/reviews/edit/${reviewId}`);\n    };\n\n    return (\n        <div className=\"d-flex flex-column align-items-center my-5\">\n            {/* User Profile Section */}\n            <div className=\"d-flex align-items-center mb-4 mt-5\">\n                {user.profile_image && (\n                    <img\n                        src={user.profile_image} // Displays the user's profile image if available\n                        alt=\"User Profile\"\n                        className=\"rounded-circle\"\n                        style={{ width: '100px', height: '100px', objectFit: 'cover', marginRight: '15px' }}\n                    />\n                )}\n                <button\n                    className=\"btn btn-outline-primary\"\n                    onClick={handleEditProfile} // Button to edit user profile\n                >\n                    Edit Profile\n                </button>\n            </div>\n            <div>\n                {/* Button to navigate to Django admin panel, visible only to superusers */}\n                {user.is_superuser && (\n                    <button\n                        className=\"btn btn-outline-primary mt-3\"\n                        onClick={() => window.open('http://localhost:8000/admin/', '_blank')}   // Redirect to Django admin\n                    >\n                        Admin Panel\n                    </button>\n                )}\n            </div>\n            {/* Greeting message for the user */}\n            <h1>Hello {user.username}, Welcome to your reviews!</h1>\n            {error && <p className=\"text-danger\">{error}</p>} {/* Displays error messages, if any */}\n\n            {/* Reviews List */}\n            <ul className=\"list-unstyled\">\n                {reviews.length > 0 ? (\n                    reviews.map((review) => (\n                        <li key={review.id} className=\"mb-4 mt-5\">\n                            {/* Displays review image if available */}\n                            {review.img && (\n                                <div className=\"d-flex justify-content-center mb-2 mt-5\">\n                                    <img\n                                        src={review.img}\n                                        alt={review.title}\n                                        className=\"img-fluid\"\n                                        style={{ maxWidth: '200px', height: 'auto' }}\n                                    />\n                                </div>\n                            )}\n                            {/* Review Details */}\n                            <div className=\"text-center\">\n                                <h4>{review.title}</h4>\n                                <p><strong>Author/Director:</strong> {review.author_director}</p>\n                                <p>{review.content}</p>\n                                <p><strong>Genre:</strong> {review.genre_name}</p>\n                                <p><strong>Rating:</strong> {review.rating}/5</p>\n                                {/* Buttons to edit or delete the review */}\n                                <button\n                                    className=\"btn btn-primary me-2\"\n                                    onClick={() => handleEdit(review.id)}\n                                >\n                                    Edit\n                                </button>\n                                <button\n                                    className=\"btn btn-danger\"\n                                    onClick={() => deleteReview(review.id)}\n                                >\n                                    Delete\n                                </button>\n                            </div>\n                        </li>\n                    ))\n                ) : (\n                    <p>No reviews found.</p>\n                )}\n            </ul>\n        </div>\n    );\n};\n\nexport default UserReviews;\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}